<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Google ç›¸ç°¿è¤‡åˆæœå°‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Leaflet åœ°åœ–å¥—ä»¶ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        #map { height: 200px; width: 100%; z-index: 1; }
        .leaflet-pane { z-index: 1 !important; }
        .leaflet-control { z-index: 2 !important; }
        
        /* Checkbox è‡ªå®šç¾©æ¨£å¼ */
        .checkbox-wrapper input:checked + div {
            background-color: #eff6ff;
            border-color: #3b82f6;
            color: #1d4ed8;
        }
        .checkbox-wrapper input:checked + div .check-icon {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden flex flex-col pb-6">
        
        <!-- æ¨™é¡Œå€ -->
        <div class="bg-blue-600 p-4 text-center z-10 relative shadow-md">
            <h1 class="text-white text-lg font-bold flex items-center justify-center gap-2">
                <i class="fa-solid fa-users-viewfinder"></i> ç›¸ç°¿è¤‡åˆæœå°‹å™¨
            </h1>
        </div>

        <!-- åœ°åœ–é è¦½å€ -->
        <div id="map" class="bg-gray-200 border-b border-gray-300"></div>

        <div class="p-5 space-y-5">

            <!-- æ­¥é©Ÿ 1: åœ°é» -->
            <div class="space-y-2">
                <label class="text-xs font-bold text-gray-500 uppercase tracking-wide">Step 1: è¨­å®šåœ°é»</label>
                
                <div class="flex gap-2">
                    <div class="relative flex-1">
                        <i class="fa-solid fa-map-pin absolute left-3 top-3 text-gray-400"></i>
                        <input id="location-input" type="text" placeholder="ä¾‹å¦‚: ç¥æˆ¶å¸‚" 
                            class="w-full appearance-none border border-gray-300 rounded-lg py-2 pl-10 pr-4 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm transition">
                    </div>
                    <button onclick="searchGPS()" id="gps-btn"
                        class="bg-white border border-gray-300 text-gray-700 px-3 rounded-lg hover:bg-gray-50 hover:text-blue-600 transition shadow-sm" title="å®šä½ç›®å‰ä½ç½®">
                        <i class="fa-solid fa-location-crosshairs text-lg"></i>
                    </button>
                </div>
                <p id="status-bar" class="text-xs text-blue-600 min-h-[1rem] truncate"></p>
            </div>

            <div class="border-t border-gray-100"></div>

            <!-- æ­¥é©Ÿ 2: é¸æ“‡äººç‰© -->
            <div class="space-y-2">
                <label class="text-xs font-bold text-gray-500 uppercase tracking-wide">Step 2: åŒ…å«äººç‰© (å¯å¤šé¸)</label>
                
                <div class="grid grid-cols-2 gap-3">
                    <!-- äººç‰©é¸é … 1 -->
                    <label class="checkbox-wrapper cursor-pointer relative">
                        <input type="checkbox" value="è”£ç¿Šé½Š" class="peer sr-only">
                        <div class="border border-gray-200 rounded-lg p-3 flex items-center justify-between transition hover:bg-gray-50">
                            <span class="font-medium text-gray-700">è”£ç¿Šé½Š</span>
                            <i class="fa-solid fa-check check-icon text-blue-600 opacity-0 transition-opacity"></i>
                        </div>
                    </label>

                    <!-- äººç‰©é¸é … 2 -->
                    <label class="checkbox-wrapper cursor-pointer relative">
                        <input type="checkbox" value="è”£å®¥æ˜‡" class="peer sr-only">
                        <div class="border border-gray-200 rounded-lg p-3 flex items-center justify-between transition hover:bg-gray-50">
                            <span class="font-medium text-gray-700">è”£å®¥æ˜‡</span>
                            <i class="fa-solid fa-check check-icon text-blue-600 opacity-0 transition-opacity"></i>
                        </div>
                    </label>

                    <!-- äººç‰©é¸é … 3 -->
                    <label class="checkbox-wrapper cursor-pointer relative">
                        <input type="checkbox" value="é™³æ¦®èŠ³" class="peer sr-only">
                        <div class="border border-gray-200 rounded-lg p-3 flex items-center justify-between transition hover:bg-gray-50">
                            <span class="font-medium text-gray-700">é™³æ¦®èŠ³</span>
                            <i class="fa-solid fa-check check-icon text-blue-600 opacity-0 transition-opacity"></i>
                        </div>
                    </label>

                    <!-- äººç‰©é¸é … 4 -->
                    <label class="checkbox-wrapper cursor-pointer relative">
                        <input type="checkbox" value="è”£å®—æ†" class="peer sr-only">
                        <div class="border border-gray-200 rounded-lg p-3 flex items-center justify-between transition hover:bg-gray-50">
                            <span class="font-medium text-gray-700">è”£å®—æ†</span>
                            <i class="fa-solid fa-check check-icon text-blue-600 opacity-0 transition-opacity"></i>
                        </div>
                    </label>
                </div>
            </div>

            <!-- æ­¥é©Ÿ 3: é€å‡ºæœå°‹ -->
            <div class="pt-2">
                <button onclick="executeSearch()" 
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3.5 rounded-xl shadow-lg transition transform active:scale-95 flex items-center justify-center gap-2 text-lg">
                    <i class="fa-brands fa-google"></i>
                    <span>æœå°‹ç›¸ç°¿</span>
                </button>
            </div>

            <!-- æœå°‹é è¦½èˆ‡æ•‘æ´é€£çµ -->
            <div id="result-area" class="hidden bg-gray-50 p-3 rounded-lg border border-gray-200 text-center space-y-2">
                <p class="text-xs text-gray-500">å°‡æœå°‹ï¼š<span id="search-query-preview" class="font-bold text-gray-800">--</span></p>
                <a id="final-link" href="#" target="_blank" class="text-sm text-blue-600 underline font-medium">
                    å¦‚æœæ²’åæ‡‰ï¼Œè«‹é»æ­¤æ‰‹å‹•é–‹å•Ÿ
                </a>
            </div>

        </div>
    </div>

    <script>
        // åˆå§‹åŒ–åœ°åœ– (é è¨­è¦–é‡)
        var map = L.map('map').setView([23.973875, 120.982024], 6);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OSM'
        }).addTo(map);
        var currentMarker = null;

        // ç‹€æ…‹æ›´æ–°
        function setStatus(msg, isError = false) {
            const el = document.getElementById('status-bar');
            el.innerText = msg;
            el.className = `text-xs min-h-[1rem] truncate ${isError ? 'text-red-500 font-bold' : 'text-blue-600'}`;
        }

        // æ›´æ–°åœ°åœ–ä½ç½®
        function updateMap(lat, lon, zoom = 13) {
            if (currentMarker) map.removeLayer(currentMarker);
            map.setView([lat, lon], zoom);
            currentMarker = L.marker([lat, lon]).addTo(map);
            map.invalidateSize();
        }

        // --- åŠŸèƒ½ A: GPS å®šä½ ---
        function searchGPS() {
            setStatus('GPS å®šä½ä¸­...');
            
            if (!navigator.geolocation) {
                setStatus('æ‚¨çš„è£ç½®ä¸æ”¯æ´ GPS', true);
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    
                    updateMap(lat, lon, 14);
                    setStatus('å®šä½æˆåŠŸï¼Œæ­£åœ¨å–å¾—åœ°å...');

                    // åå‘åœ°ç†ç·¨ç¢¼
                    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=14`)
                        .then(res => res.json())
                        .then(data => {
                            // å˜—è©¦æŠ“å–å„ç¨®å±¤ç´šçš„åœ°å
                            let place = "";
                            if (data.address) {
                                place = data.address.city || 
                                        data.address.town || 
                                        data.address.district || 
                                        data.address.county || 
                                        data.address.state || "";
                            }
                            
                            if (place) {
                                document.getElementById('location-input').value = place;
                                setStatus(`ğŸ“ å·²å®šä½ï¼š${place}`);
                            } else {
                                setStatus('ç„¡æ³•è¾¨è­˜åœ°åï¼Œè«‹æ‰‹å‹•è¼¸å…¥', true);
                            }
                        })
                        .catch(err => setStatus('ç¶²è·¯éŒ¯èª¤ï¼Œè«‹æ‰‹å‹•è¼¸å…¥', true));
                },
                (err) => {
                    console.error(err);
                    setStatus('å®šä½å¤±æ•—ï¼Œè«‹ç¢ºèªæ¬Šé™æˆ–é–‹å•Ÿ GPS', true);
                },
                { enableHighAccuracy: true, timeout: 5000 }
            );
        }

        // --- åŠŸèƒ½ B: åŸ·è¡Œæœå°‹ ---
        function executeSearch() {
            // 1. å–å¾—åœ°é»
            const locationInput = document.getElementById('location-input');
            const locationVal = locationInput.value.trim();

            if (!locationVal) {
                setStatus('è«‹è¼¸å…¥æˆ–å®šä½åœ°é»ï¼', true);
                locationInput.focus();
                // éœ‡å‹•æç¤º
                if(navigator.vibrate) navigator.vibrate(200);
                return;
            }

            // å¦‚æœæœ‰è¼¸å…¥åœ°é»ï¼Œå˜—è©¦æ›´æ–°åœ°åœ– (è‹¥æ˜¯æ‰‹å‹•è¼¸å…¥çš„æƒ…æ³)
            // ä¸ç­‰å¾…åœ°åœ–å›æ‡‰ç›´æ¥æœå°‹ï¼Œä½¿ç”¨è€…é«”é©—è¼ƒå¿«
            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(locationVal)}`)
                .then(res => res.json())
                .then(data => {
                    if (data && data.length > 0) {
                        updateMap(parseFloat(data[0].lat), parseFloat(data[0].lon));
                    }
                });

            // 2. å–å¾—å‹¾é¸çš„äººç‰©
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            let selectedPeople = [];
            checkboxes.forEach((cb) => {
                selectedPeople.push(cb.value);
            });

            // 3. çµ„åˆæœå°‹å­—ä¸²
            // æ ¼å¼ï¼šåœ°é» + ç©ºç™½ + äººå1 + ç©ºç™½ + äººå2...
            let finalQuery = locationVal;
            if (selectedPeople.length > 0) {
                finalQuery += " " + selectedPeople.join(" ");
            }

            // 4. ç”¢ç”Ÿé€£çµä¸¦é–‹å•Ÿ
            const googlePhotosUrl = `https://photos.google.com/search/${encodeURIComponent(finalQuery)}`;
            
            // æ›´æ–°é è¦½å€
            document.getElementById('search-query-preview').innerText = finalQuery;
            const finalLink = document.getElementById('final-link');
            finalLink.href = googlePhotosUrl;
            document.getElementById('result-area').classList.remove('hidden');

            // å˜—è©¦è‡ªå‹•é–‹å•Ÿ
            window.open(googlePhotosUrl, '_blank');
        }
    </script>
</body>
</html>
